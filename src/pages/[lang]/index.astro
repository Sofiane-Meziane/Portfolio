---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import { getCollection } from "astro:content";
import { i18n, defaultLang, isLang, languages } from "../../lib/i18n";

export async function getStaticPaths() {
  return languages.map((lang) => ({ params: { lang } }));
}

const { lang: rawLang } = Astro.params;
const lang = isLang(rawLang) ? rawLang : defaultLang;
const t = i18n[lang];

const projects = (await getCollection("projects"))
  .filter((project) => project.slug.startsWith(`${lang}/`))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const featured = projects.filter((project) => project.data.featured);
const latest = projects.slice(0, 4);
const baseSlug = (slug) => slug.split("/").slice(1).join("/");
---

<BaseLayout lang={lang} title={`${t.siteName} | ${t.siteTitle}`} description={t.siteDescription}>
  <section class="pt-12">
    <div class="grid gap-10 lg:grid-cols-[1.15fr,0.85fr]">
      <div class="space-y-6 animate-fade-up">
        <div class="pill">{t.heroPill}</div>
        <h1 class="text-balance text-4xl sm:text-5xl lg:text-6xl font-display">
          {t.heroTitle}
        </h1>
        <p class="text-lg text-ink/80">
          {t.heroBody}
        </p>
        <div class="flex flex-wrap gap-4">
          <a
            href={`/${lang}/projects`}
            class="inline-flex items-center gap-2 rounded-full bg-ink px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-paper transition hover:-translate-y-0.5"
          >
            {t.ctaProjects}
          </a>
          <a
            href="https://github.com/Sofiane-Meziane"
            class="inline-flex items-center gap-2 rounded-full border border-ink/20 px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-ink/70 transition hover:text-ink"
          >
            {t.ctaGitHub}
          </a>
        </div>
        <div class="flex flex-wrap gap-3 text-xs uppercase tracking-[0.2em] text-ink/60">
          <span>Astro</span>
          <span>Markdown</span>
          <span>Tailwind</span>
        </div>
      </div>

      <div class="glass p-6 animate-fade-up animate-fade-up-2">
        <div class="space-y-6">
          <div>
            <p class="text-xs uppercase tracking-[0.2em] text-ink/60">{t.focusLabel}</p>
            <h2 class="mt-2 text-2xl font-display">{t.focusTitle}</h2>
            <p class="mt-3 text-sm text-ink/70">{t.focusBody}</p>
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            <div class="card">
              <p class="text-xs uppercase tracking-[0.2em] text-ink/60">{t.coreAreasLabel}</p>
              <p class="mt-2 text-lg font-display">{t.coreAreasValue}</p>
            </div>
            <div class="card">
              <p class="text-xs uppercase tracking-[0.2em] text-ink/60">{t.workflowLabel}</p>
              <p class="mt-2 text-lg font-display">{t.workflowValue}</p>
            </div>
          </div>
          <div class="card">
            <p class="text-xs uppercase tracking-[0.2em] text-ink/60">{t.toolingLabel}</p>
            <p class="mt-2 text-base text-ink/80">
              {t.toolingValue}
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  {featured.length > 0 && (
    <section class="mt-16 animate-fade-up animate-fade-up-2">
      <div class="flex items-end justify-between">
        <div>
          <p class="text-xs uppercase tracking-[0.2em] text-ink/60">{t.featuredLabel}</p>
          <h2 class="mt-2 text-3xl font-display">{t.featuredTitle}</h2>
        </div>
        <a href={`/${lang}/projects`} class="text-sm font-semibold text-sea hover:text-ink">
          {t.allProjects}
        </a>
      </div>
      <div class="mt-8 grid gap-6 lg:grid-cols-2">
        {featured.map((project) => (
          <ProjectCard project={project} lang={lang} href={`/${lang}/projects/${baseSlug(project.slug)}`} />
        ))}
      </div>
    </section>
  )}

  <section class="mt-16 animate-fade-up animate-fade-up-3">
    <div>
      <p class="text-xs uppercase tracking-[0.2em] text-ink/60">{t.latestLabel}</p>
      <h2 class="mt-2 text-3xl font-display">{t.latestTitle}</h2>
    </div>
    <div class="mt-8 grid gap-6 lg:grid-cols-2">
      {latest.map((project) => (
        <ProjectCard project={project} lang={lang} href={`/${lang}/projects/${baseSlug(project.slug)}`} />
      ))}
    </div>
  </section>
</BaseLayout>